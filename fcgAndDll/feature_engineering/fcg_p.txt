import re # (确保在文件顶部导入 re)

def clean_function_name(name: str) -> Optional[str]:
    """
    清理函数名，移除@后缀，但保留 'sub_' 等内部函数名。
    
    Args:
        name: 原始函数名
        
    Returns:
        清理后的函数名
    """
    if not name:
        return None
        
    # 移除 @<数字> 后缀 (例如 _WinMain@16 -> _WinMain)
    cleaned_name = re.sub(r'@\d+$', '', name)
    
    # 移除函数名前的 _ 或 @ 符号
    # (例如 _memset -> memset, @GetProcAddress -> GetProcAddress)
    cleaned_name = cleaned_name.lstrip('_@')
    
    # 如果清理后为空，则返回None
    if not cleaned_name:
        return None

    # sub_401000 这类函数名会被保留，因为它们不匹配上述规则
    return cleaned_name